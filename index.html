        // 删除戳戳我
        function deletePoke(id) {
            if (confirm('确定要删除这张图片吗？')) {
                const pokeData = JSON.parse(localStorage.getItem('pokeData') || '[]');
                const newData = pokeData.filter(item => item.id !== id);
                localStorage.setItem('pokeData', JSON.stringify(newData));
                loadPokeData();
                alert('图片已删除！');
            }
        }
        
        // 重置戳戳我表单
        function resetPokeForm() {
            document.getElementById('poke-form').reset();
            document.getElementById('poke-id').value = '';
            document.getElementById('poke-upload-form').style.display = 'none';
            document.getElementById('poke-password-section').style.display = 'block';
            document.getElementById('poke-password').value = '';
            editMode.poke = false;
        }
        
        // 加载设置
        function loadSettings() {
            // 加载LOGO
            const logoData = localStorage.getItem('siteLogo');
            if (logoData) {
                const logoPreview = document.getElementById('logo-preview-area');
                const headerLogo = document.getElementById('logo-preview');
                
                logoPreview.innerHTML = `<img src="${logoData}" alt="LOGO" style="max-width:100%; max-height:100%;">`;
                
                if (headerLogo.classList.contains('logo-placeholder')) {
                    headerLogo.classList.remove('logo-placeholder');
                    headerLogo.classList.add('logo');
                    headerLogo.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = logoData;
                    img.alt = 'LOGO';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '10px';
                    headerLogo.appendChild(img);
                    
                    // 点击LOGO可以查看大图
                    headerLogo.onclick = function() {
                        showImagePreview(logoData);
                    };
                }
            }
            
            // 加载背景
            const bgData = localStorage.getItem('siteBackground');
            if (bgData) {
                document.body.style.backgroundImage = `url(${bgData})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
                document.body.style.backgroundAttachment = 'fixed';
                
                const bgPreview = document.getElementById('bg-preview-area');
                bgPreview.innerHTML = `<img src="${bgData}" alt="背景预览" style="max-width:100%; max-height:100%;">`;
            }
        }
        
        // 上传LOGO
        function uploadLogo() {
            const fileInput = document.getElementById('logo-file');
            if (!fileInput.files[0]) {
                alert('请选择LOGO文件！');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                localStorage.setItem('siteLogo', e.target.result);
                loadSettings();
                alert('LOGO上传成功！');
                fileInput.value = '';
            };
            
            reader.readAsDataURL(file);
        }
        
        // 删除LOGO
        function deleteLogo() {
            if (confirm('确定要删除LOGO吗？')) {
                localStorage.removeItem('siteLogo');
                loadSettings();
                alert('LOGO已删除！');
            }
        }
        
        // 上传背景
        function uploadBackground() {
            const fileInput = document.getElementById('bg-file');
            if (!fileInput.files[0]) {
                alert('请选择背景文件！');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                localStorage.setItem('siteBackground', e.target.result);
                loadSettings();
                alert('背景上传成功！');
                fileInput.value = '';
            };
            
            reader.readAsDataURL(file);
        }
        
        // 删除背景
        function deleteBackground() {
            if (confirm('确定要删除背景吗？')) {
                localStorage.removeItem('siteBackground');
                document.body.style.backgroundImage = '';
                document.body.style.backgroundColor = '#f5f7fa';
                
                const bgPreview = document.getElementById('bg-preview-area');
                bgPreview.innerHTML = '<span>背景预览</span>';
                
                alert('背景已删除！');
            }
        }
        
        // 数据导出功能（可选）
        function exportAllData() {
            const allData = {
                noticeData: JSON.parse(localStorage.getItem('noticeData') || '[]'),
                networkData: JSON.parse(localStorage.getItem('networkData') || '[]'),
                feeData: JSON.parse(localStorage.getItem('feeData') || '[]'),
                cabinetData: JSON.parse(localStorage.getItem('cabinetData') || '[]'),
                receiverData: JSON.parse(localStorage.getItem('receiverData') || '[]'),
                pokeData: JSON.parse(localStorage.getItem('pokeData') || '[]'),
                siteLogo: localStorage.getItem('siteLogo') || '',
                siteBackground: localStorage.getItem('siteBackground') || '',
                exportDate: new Date().toLocaleString('zh-CN')
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `里昂星储备份_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('数据备份成功！文件已下载。');
        }
        
        // 数据导入功能（可选）
        function importAllData() {
            if (!confirm('导入数据将覆盖当前所有数据，确定要继续吗？')) {
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // 验证数据格式
                        if (data.noticeData) localStorage.setItem('noticeData', JSON.stringify(data.noticeData));
                        if (data.networkData) localStorage.setItem('networkData', JSON.stringify(data.networkData));
                        if (data.feeData) localStorage.setItem('feeData', JSON.stringify(data.feeData));
                        if (data.cabinetData) localStorage.setItem('cabinetData', JSON.stringify(data.cabinetData));
                        if (data.receiverData) localStorage.setItem('receiverData', JSON.stringify(data.receiverData));
                        if (data.pokeData) localStorage.setItem('pokeData', JSON.stringify(data.pokeData));
                        if (data.siteLogo) localStorage.setItem('siteLogo', data.siteLogo);
                        if (data.siteBackground) localStorage.setItem('siteBackground', data.siteBackground);
                        
                        // 重新加载所有数据
                        loadAllData();
                        alert('数据导入成功！');
                    } catch (err) {
                        alert('文件格式错误或已损坏！');
                        console.error('数据导入错误:', err);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // 添加管理工具按钮（可选）
        function addAdminTools() {
            // 检查是否已存在管理工具
            if (document.getElementById('admin-tools')) return;
            
            const settingsTab = document.getElementById('settings');
            const adminToolsDiv = document.createElement('div');
            adminToolsDiv.id = 'admin-tools';
            adminToolsDiv.className = 'setting-item';
            adminToolsDiv.style.marginTop = '30px';
            adminToolsDiv.style.borderTop = '2px solid #eee';
            adminToolsDiv.style.paddingTop = '20px';
            
            adminToolsDiv.innerHTML = `
                <h3>系统管理工具</h3>
                <p>高级管理功能，请谨慎操作</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="exportAllData()">备份所有数据</button>
                    <button class="btn btn-secondary" onclick="importAllData()">恢复数据</button>
                    <button class="btn btn-danger" onclick="clearAllData()">清空所有数据</button>
                </div>
            `;
            
            settingsTab.querySelector('#settings-content').appendChild(adminToolsDiv);
        }
        
        // 清空所有数据
        function clearAllData() {
            if (!confirm('确定要清空所有数据吗？此操作不可恢复！')) {
                return;
            }
            
            localStorage.clear();
            
            // 重新加载页面
            location.reload();
        }
        
        // 在设置页面加载后添加管理工具
        document.getElementById('settings-auth-btn').addEventListener('click', function() {
            const password = document.getElementById('settings-password').value;
            if (password === DEFAULT_PASSWORD) {
                // 显示设置内容
                document.getElementById('settings-password-section').style.display = 'none';
                document.getElementById('settings-content').style.display = 'block';
                
                // 添加管理工具
                setTimeout(() => {
                    addAdminTools();
                }, 100);
            }
        });
        
        // 页面加载完成后的初始化
        window.addEventListener('load', function() {
            // 加载所有数据
            loadAllData();
            
            // 添加键盘快捷键
            document.addEventListener('keydown', function(e) {
                // Ctrl + S 保存当前表单
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    
                    switch(currentTab) {
                        case 'notice':
                            if (document.getElementById('notice-upload-form').style.display !== 'none') {
                                document.getElementById('notice-form').dispatchEvent(new Event('submit'));
                            }
                            break;
                        case 'network':
                            if (document.getElementById('network-upload-form').style.display !== 'none') {
                                document.getElementById('network-form').dispatchEvent(new Event('submit'));
                            }
                            break;
                        case 'fee':
                            if (document.getElementById('fee-upload-form').style.display !== 'none') {
                                document.getElementById('fee-form').dispatchEvent(new Event('submit'));
                            }
                            break;
                        case 'cabinet':
                            // 如果在柜信息弹窗打开
                            if (document.getElementById('cabinet-popup-form').style.display === 'flex') {
                                document.getElementById('cabinet-form').dispatchEvent(new Event('submit'));
                            }
                            break;
                        case 'poke':
                            if (document.getElementById('poke-upload-form').style.display !== 'none') {
                                document.getElementById('poke-form').dispatchEvent(new Event('submit'));
                            }
                            break;
                    }
                }
                
                // Esc 键关闭弹窗
                if (e.key === 'Escape') {
                    const cabinetPopup = document.getElementById('cabinet-popup-form');
                    const receiverPopup = document.getElementById('receiver-popup-form');
                    const imageModal = document.getElementById('image-modal');
                    
                    if (cabinetPopup.style.display === 'flex') {
                        cabinetPopup.style.display = 'none';
                    }
                    
                    if (receiverPopup.style.display === 'flex') {
                        receiverPopup.style.display = 'none';
                    }
                    
                    if (imageModal.classList.contains('active')) {
                        imageModal.classList.remove('active');
                    }
                }
            });
            
            // 显示欢迎信息
            console.log('里昂星储查询系统已启动！');
            console.log('系统功能包括：公告管理、网点清单、资费清单、在柜信息管理、取件人信息管理、戳戳我图片管理等');
            console.log('默认管理密码：740302');
        });
    </script>
</body>
</html>
